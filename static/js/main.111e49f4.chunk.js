(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{304:function(e,t,a){e.exports=a(493)},310:function(e,t,a){},493:function(e,t,a){"use strict";a.r(t);var n=a(74),r=a.n(n);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var o=a(0),l=a.n(o),c=a(37),m=a(21),s=a(505),i=(a(309),a(310),a(19)),u=a(64),d=a(259),p=a.n(d),b={user:null};if(localStorage.getItem("jwtToken")){var E=p()(localStorage.getItem("jwtToken"));1e3*E.exp<Date.now()?localStorage.removeItem("jwtToken"):b.user=E}var g=Object(o.createContext)({user:null,login:function(e){},logout:function(){}});function v(e,t){switch(t.type){case"LOGIN":return Object(u.a)(Object(u.a)({},e),{},{user:t.payload});case"LOGOUT":return Object(u.a)(Object(u.a)({},e),{},{user:null});default:return e}}function f(e){var t=Object(o.useReducer)(v,b),a=Object(i.a)(t,2),n=a[0],r=a[1];return l.a.createElement(g.Provider,Object.assign({value:{user:n.user,login:function(e){localStorage.setItem("jwtToken",e.token),r({type:"LOGIN",payload:e})},logout:function(){localStorage.removeItem("jwtToken"),r({type:"LOGOUT"})}}},e))}var h=a(295);var j=function(e){var t=e.component,a=Object(h.a)(e,["component"]),n=Object(o.useContext)(g).user;return l.a.createElement(m.b,Object.assign({},a,{render:function(e){return n?l.a.createElement(m.a,{to:"/"}):l.a.createElement(t,e)}}))},O=a(512);var y=function(){var e=Object(o.useContext)(g),t=e.user,a=e.logout,n=window.location.pathname,r="/"===n?"home":n.substr(1),m=Object(o.useState)(r),s=Object(i.a)(m,2),u=s[0],d=s[1],p=function(e,t){var a=t.name;return d(a)};return t?l.a.createElement(O.a,{pointing:!0,secondary:!0,size:"massive",color:"teal"},l.a.createElement(O.a.Item,{name:t.username,active:!0,as:c.b,to:"/"}),l.a.createElement(O.a.Menu,{position:"right"},l.a.createElement(O.a.Item,{name:"logout",onClick:a}))):l.a.createElement(O.a,{pointing:!0,secondary:!0,size:"massive",color:"teal"},l.a.createElement(O.a.Item,{name:"home",active:"home"===u,onClick:p,as:c.b,to:"/"}),l.a.createElement(O.a.Menu,{position:"right"},l.a.createElement(O.a.Item,{name:"login",active:"login"===u,onClick:p,as:c.b,to:"/login"}),l.a.createElement(O.a.Item,{name:"register",active:"register"===u,onClick:p,as:c.b,to:"/register"})))},C=a(31),w=a(513),I=a(515),k=a(510),P=a(291),S=a(511),$=a(87),x=a(139),N=a(103),A=a.n(N),D=a(32),L=a(33),R=a.n(L),T=a(509);var Q,U=function(e){var t=e.content,a=e.children;return l.a.createElement(T.a,{inverted:!0,content:t,trigger:a})};var q,z,B,G=R()(Q||(Q=Object(D.a)(["\n  mutation likePost($postId: ID!) {\n    likePost(postId: $postId) {\n      id\n      likes {\n        id\n        username\n      }\n      likeCount\n    }\n  }\n"]))),M=function(e){var t=e.user,a=e.post,n=a.id,r=a.likeCount,m=a.likes,s=Object(o.useState)(!1),u=Object(i.a)(s,2),d=u[0],p=u[1];Object(o.useEffect)(function(){t&&m.find(function(e){return e.username===t.username})?p(!0):p(!1)},[t,m]);var b=Object(C.a)(G,{variables:{postId:n}}),E=Object(i.a)(b,1)[0],g=t?d?l.a.createElement(S.a,{color:"teal"},l.a.createElement($.a,{name:"heart"})):l.a.createElement(S.a,{color:"teal",basic:!0},l.a.createElement($.a,{name:"heart"})):l.a.createElement(S.a,{as:c.b,to:"/login",color:"teal",basic:!0},l.a.createElement($.a,{name:"heart"}));return l.a.createElement(S.a,{as:"div",labelPosition:"right",onClick:E},l.a.createElement(U,{content:d?"Unlike":"Like"},g),l.a.createElement(x.a,{basic:!0,color:"teal",pointing:"left"},r))},H=a(507),F=R()(q||(q=Object(D.a)(["\n  {\n    getPosts {\n      id\n      body\n      createdAt\n      username\n      likeCount\n      likes {\n        username\n      }\n      commentCount\n      comments {\n        id\n        username\n        createdAt\n        body\n      }\n    }\n  }\n"])));var W=R()(z||(z=Object(D.a)(["\n  mutation deletePost($postId: ID!) {\n    deletePost(postId: $postId)\n  }\n"]))),J=R()(B||(B=Object(D.a)(["\n  mutation deleteComment($postId: ID!, $commentId: ID!) {\n    deleteComment(postId: $postId, commentId: $commentId) {\n      id\n      comments {\n        id\n        username\n        createdAt\n        body\n      }\n      commentCount\n    }\n  }\n"]))),V=function(e){var t=e.postId,a=e.commentId,n=e.callback,r=Object(o.useState)(!1),c=Object(i.a)(r,2),m=c[0],s=c[1],u=a?J:W,d=Object(C.a)(u,{update:function(e){if(s(!1),!a){var r=e.readQuery({query:F});r.getPosts=r.getPosts.filter(function(e){return e.id!==t}),e.writeQuery({query:F,data:r})}n&&n()},variables:{postId:t,commentId:a}}),p=Object(i.a)(d,1)[0];return l.a.createElement(l.a.Fragment,null,l.a.createElement(U,{content:a?"Delete comment":"Delete post"},l.a.createElement(S.a,{as:"div",color:"red",floated:"right",onClick:function(){return s(!0)}},l.a.createElement($.a,{name:"trash",style:{margin:0}}))),l.a.createElement(H.a,{open:m,onCancel:function(){return s(!1)},onConfirm:p}))};var K,X=function(e){var t=e.post,a=t.body,n=t.createdAt,r=t.id,m=t.username,s=t.likeCount,i=t.commentCount,u=t.likes,d=Object(o.useContext)(g).user;return l.a.createElement(k.a,{fluid:!0},l.a.createElement(k.a.Content,null,l.a.createElement(P.a,{floated:"right",size:"mini",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"}),l.a.createElement(k.a.Header,null,m),l.a.createElement(k.a.Meta,{as:c.b,to:"/posts/".concat(r)},A()(n).fromNow(!0)),l.a.createElement(k.a.Description,null,a)),l.a.createElement(k.a.Content,{extra:!0},l.a.createElement(M,{user:d,post:{id:r,likes:u,likeCount:s}}),l.a.createElement(U,{content:"Comment on post"},l.a.createElement(S.a,{labelPosition:"right",as:c.b,to:"/posts/".concat(r)},l.a.createElement(S.a,{color:"blue",basic:!0},l.a.createElement($.a,{name:"comments"})),l.a.createElement(x.a,{basic:!0,color:"green",pointing:"left"},i))),d&&d.username===m&&l.a.createElement(V,{postId:r})))},Y=a(293),Z=a(506),_=a(131),ee=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Object(o.useState)(t),n=Object(i.a)(a,2),r=n[0],l=n[1];return{onChange:function(e){l(Object(u.a)(Object(u.a)({},r),{},Object(_.a)({},e.target.name,e.target.value)))},onSubmit:function(t){t.preventDefault(),e()},values:r}};var te=R()(K||(K=Object(D.a)(["\n  mutation createPost($body: String!) {\n    createPost(body: $body) {\n      id\n      body\n      createdAt\n      username\n      likes {\n        id\n        username\n        createdAt\n      }\n      likeCount\n      comments {\n        id\n        body\n        username\n        createdAt\n      }\n      commentCount\n    }\n  }\n"]))),ae=function(){var e=ee(function(){c()},{body:""}),t=e.values,a=e.onChange,n=e.onSubmit,r=Object(C.a)(te,{variables:t,update:function(e,a){var n=e.readQuery({query:F});n.getPosts=[a.data.createPost].concat(Object(Y.a)(n.getPosts)),e.writeQuery({query:F,data:n}),t.body=""}}),o=Object(i.a)(r,2),c=o[0],m=o[1].error;return l.a.createElement(l.a.Fragment,null,l.a.createElement(Z.a,{onSubmit:n},l.a.createElement("h2",null,"Create a post:"),l.a.createElement(Z.a.Field,null,l.a.createElement(Z.a.Input,{placeholder:"Hi World!",name:"body",onChange:a,value:t.body,error:!!m}),l.a.createElement(S.a,{type:"submit",color:"teal"},"Submit"))),m&&l.a.createElement("div",{className:"ui error message",style:{marginBottom:20}},l.a.createElement("ul",{className:"list"},l.a.createElement("li",null,m.graphQLErrors[0].message))))};var ne,re=function(){var e=Object(o.useContext)(g).user,t=Object(C.b)(F),a=t.loading,n=t.data,r=(n=void 0===n?{}:n).getPosts;return l.a.createElement(w.a,{columns:3},l.a.createElement(w.a.Row,{className:"page-title"},l.a.createElement("h1",null,"Recent Posts")),l.a.createElement(w.a.Row,null,e&&l.a.createElement(w.a.Column,null,l.a.createElement(ae,null)),a?l.a.createElement("h1",null,"Loading posts.."):l.a.createElement(I.a.Group,null,r&&r.map(function(e){return l.a.createElement(w.a.Column,{key:e.id,style:{marginBottom:20}},l.a.createElement(X,{post:e}))}))))};var oe,le=R()(ne||(ne=Object(D.a)(["\n  mutation login($username: String!, $password: String!) {\n    login(username: $username, password: $password) {\n      id\n      email\n      username\n      createdAt\n      token\n    }\n  }\n"]))),ce=function(e){var t=Object(o.useContext)(g),a=Object(o.useState)({}),n=Object(i.a)(a,2),r=n[0],c=n[1],m=ee(function(){E()},{username:"",password:""}),s=m.onChange,u=m.onSubmit,d=m.values,p=Object(C.a)(le,{update:function(a,n){var r=n.data.login;t.login(r),e.history.push("/")},onError:function(e){c(e.graphQLErrors[0].extensions.exception.errors)},variables:d}),b=Object(i.a)(p,2),E=b[0],v=b[1].loading;return l.a.createElement("div",{className:"form-container"},l.a.createElement(Z.a,{onSubmit:u,noValidate:!0,className:v?"loading":""},l.a.createElement("h1",null,"Login"),l.a.createElement(Z.a.Input,{label:"Username",placeholder:"Username..",name:"username",type:"text",value:d.username,error:!!r.username,onChange:s}),l.a.createElement(Z.a.Input,{label:"Password",placeholder:"Password..",name:"password",type:"password",value:d.password,error:!!r.password,onChange:s}),l.a.createElement(S.a,{type:"submit",primary:!0},"Login")),Object.keys(r).length>0&&l.a.createElement("div",{className:"ui error message"},l.a.createElement("ul",{className:"list"},Object.values(r).map(function(e){return l.a.createElement("li",{key:e},e)}))))};var me,se,ie=R()(oe||(oe=Object(D.a)(["\n  mutation register(\n    $username: String!\n    $email: String!\n    $password: String!\n    $confirmPassword: String!\n  ) {\n    register(\n      registerInput: {\n        username: $username\n        email: $email\n        password: $password\n        confirmPassword: $confirmPassword\n      }\n    ) {\n      id\n      email\n      username\n      createdAt\n      token\n    }\n  }\n"]))),ue=function(e){var t=Object(o.useContext)(g),a=Object(o.useState)({}),n=Object(i.a)(a,2),r=n[0],c=n[1],m=ee(function(){E()},{username:"",email:"",password:"",confirmPassword:""}),s=m.onChange,u=m.onSubmit,d=m.values,p=Object(C.a)(ie,{update:function(a,n){var r=n.data.register;t.login(r),e.history.push("/")},onError:function(e){c(e.graphQLErrors[0].extensions.exception.errors)},variables:d}),b=Object(i.a)(p,2),E=b[0],v=b[1].loading;return l.a.createElement("div",{className:"form-container"},l.a.createElement(Z.a,{onSubmit:u,noValidate:!0,className:v?"loading":""},l.a.createElement("h1",null,"Register"),l.a.createElement(Z.a.Input,{label:"Username",placeholder:"Username..",name:"username",type:"text",value:d.username,error:!!r.username,onChange:s}),l.a.createElement(Z.a.Input,{label:"Email",placeholder:"Email..",name:"email",type:"email",value:d.email,error:!!r.email,onChange:s}),l.a.createElement(Z.a.Input,{label:"Password",placeholder:"Password..",name:"password",type:"password",value:d.password,error:!!r.password,onChange:s}),l.a.createElement(Z.a.Input,{label:"Confirm Password",placeholder:"Confirm Password..",name:"confirmPassword",type:"password",value:d.confirmPassword,error:!!r.confirmPassword,onChange:s}),l.a.createElement(S.a,{type:"submit",primary:!0},"Register")),Object.keys(r).length>0&&l.a.createElement("div",{className:"ui error message"},l.a.createElement("ul",{className:"list"},Object.values(r).map(function(e){return l.a.createElement("li",{key:e},e)}))))};var de=R()(me||(me=Object(D.a)(["\n  mutation($postId: String!, $body: String!) {\n    createComment(postId: $postId, body: $body) {\n      id\n      comments {\n        id\n        body\n        createdAt\n        username\n      }\n      commentCount\n    }\n  }\n"]))),pe=R()(se||(se=Object(D.a)(["\n  query($postId: ID!) {\n    getPost(postId: $postId) {\n      id\n      body\n      createdAt\n      username\n      likeCount\n      likes {\n        username\n      }\n      commentCount\n      comments {\n        id\n        username\n        createdAt\n        body\n      }\n    }\n  }\n"]))),be=function(e){var t,a=e.match.params.postId,n=Object(o.useContext)(g).user,r=Object(o.useRef)(null),c=Object(o.useState)(""),m=Object(i.a)(c,2),s=m[0],u=m[1],d=Object(C.b)(pe,{variables:{postId:a}}).data.getPost,p=Object(C.a)(de,{update:function(){u(""),r.current.blur()},variables:{postId:a,body:s}}),b=Object(i.a)(p,1)[0];if(d){var E=d.id,v=d.body,f=d.createdAt,h=d.username,j=d.comments,O=d.likes,y=d.likeCount,I=d.commentCount;t=l.a.createElement(w.a,null,l.a.createElement(w.a.Row,null,l.a.createElement(w.a.Column,{width:2},l.a.createElement(P.a,{src:"https://react.semantic-ui.com/images/avatar/large/molly.png",size:"small",float:"right"})),l.a.createElement(w.a.Column,{width:10},l.a.createElement(k.a,{fluid:!0},l.a.createElement(k.a.Content,null,l.a.createElement(k.a.Header,null,h),l.a.createElement(k.a.Meta,null,A()(f).fromNow()),l.a.createElement(k.a.Description,null,v)),l.a.createElement("hr",null),l.a.createElement(k.a.Content,{extra:!0},l.a.createElement(M,{user:n,post:{id:E,likeCount:y,likes:O}}),l.a.createElement(U,{content:"Comment on post"},l.a.createElement(S.a,{as:"div",labelPosition:"right",onClick:function(){return console.log("Comment on post")}},l.a.createElement(S.a,{basic:!0,color:"blue"},l.a.createElement($.a,{name:"comments"})),l.a.createElement(x.a,{basic:!0,color:"blue",pointing:"left"},I))),n&&n.username===h&&l.a.createElement(V,{postId:E,callback:function(){e.history.push("/")}}))),n&&l.a.createElement(k.a,{fluid:!0},l.a.createElement(k.a.Content,null,l.a.createElement("p",null,"Post a comment"),l.a.createElement(Z.a,null,l.a.createElement("div",{className:"ui action input fluid"},l.a.createElement("input",{type:"text",placeholder:"Comment..",name:"comment",value:s,onChange:function(e){return u(e.target.value)},ref:r}),l.a.createElement("button",{type:"submit",className:"ui button teal",disabled:""===s.trim(),onClick:b},"Submit"))))),j.map(function(e){return l.a.createElement(k.a,{fluid:!0,key:e.id},l.a.createElement(k.a.Content,null,n&&n.username===e.username&&l.a.createElement(V,{postId:E,commentId:e.id}),l.a.createElement(k.a.Header,null,e.username),l.a.createElement(k.a.Meta,null,A()(e.createdAt).fromNow()),l.a.createElement(k.a.Description,null,e.body)))}))))}else t=l.a.createElement("p",null,"Loading post..");return t};var Ee=function(){return l.a.createElement(f,null,l.a.createElement(c.a,null,l.a.createElement(s.a,null,l.a.createElement(y,null),l.a.createElement(m.b,{exact:!0,path:"/",component:re}),l.a.createElement(j,{exact:!0,path:"/login",component:ce}),l.a.createElement(j,{exact:!0,path:"/register",component:ue}),l.a.createElement(m.b,{exact:!0,path:"/posts/:postId",component:be}))))},ge=a(66),ve=a(292),fe=a(294),he=a(27),je=a(290),Oe=Object(fe.a)({uri:"http://merngraphql.herokuapp.com/"}),ye=Object(je.a)(function(){var e=localStorage.getItem("jwtToken");return{headers:{Authorization:e?"Bearer ".concat(e):""}}}),Ce=new ge.c({link:ye.concat(Oe),cache:new ve.a}),we=l.a.createElement(he.a,{client:Ce},l.a.createElement(Ee,null));r.a.render(we,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[304,1,2]]]);
//# sourceMappingURL=main.111e49f4.chunk.js.map